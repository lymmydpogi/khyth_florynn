{% extends 'ADMIN/base.html.twig' %}

{% block title %}My Profile{% endblock %}
{% block page_title %}Profile{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('style/css/DASHBOARD/profile.css') }}">
{% endblock %}

{% block body %}
<!-- Page Header -->
<div class="page-header">
    <h1>My Profile</h1>
    <p>Manage your personal information, account settings, and preferences</p>
</div>

<div class="profile-layout">
    <!-- Top Section: Profile Header -->
    <div class="profile-header-card">
        <div class="profile-header-content">
            <div class="avatar-container">
                {% if user.avatar %}
                    <img src="{{ asset('uploads/avatars/' ~ user.avatar) }}" 
                         alt="{{ user.name ?? 'User' }}" 
                         class="profile-avatar-img"
                         onerror="this.onerror=null; this.src='{{ asset('images/default-avatar.png') }}';">
                {% else %}
                    <div class="profile-avatar-initials">
                        {{ user.name ? user.name|slice(0, 2)|upper : user.email|slice(0, 2)|upper }}
                    </div>
                {% endif %}
                <form id="avatarForm" method="post" enctype="multipart/form-data" action="{{ path('app_profile') }}" class="avatar-form">
                    <input type="file" id="avatarInput" name="avatar" class="avatar-input" accept="image/*"
                           onchange="document.getElementById('avatarForm').submit()">
                    <button type="button" class="avatar-upload-btn" onclick="document.getElementById('avatarInput').click()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        Change Photo
                    </button>
                </form>
            </div>
            
            <div class="profile-header-info">
                <div class="profile-name-section">
                    <h2 class="profile-display-name">{{ user.name ?? 'No Name' }}</h2>
                    <div class="profile-role-tag">
                        {% if 'ROLE_ADMIN' in user.roles %}
                            Administrator
                        {% elseif 'ROLE_STAFF' in user.roles %}
                            Staff Member
                        {% else %}
                            Client
                        {% endif %}
                    </div>
                </div>
                
                <div class="profile-meta-info">
                    <div class="meta-item">
                        <span class="meta-label">Email</span>
                        <span class="meta-value">{{ user.email }}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Status</span>
                        <span class="meta-value status-badge status-{{ user.status ?? 'active' }}">{{ user.status ?? 'Active' }}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Member Since</span>
                        <span class="meta-value">{{ user.createdAt ? user.createdAt|date('F Y') : 'N/A' }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content: Two Column Layout -->
    <div class="profile-content-grid">
        <!-- Left Column: Account Information -->
        <div class="info-card">
            <div class="card-title-section">
                <h3>Account Information</h3>
                <p class="card-description">Your account details and preferences</p>
            </div>
            
            <div class="info-list">
                <div class="info-row">
                    <span class="info-label">User ID</span>
                    <span class="info-value">#{{ user.id }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Email Address</span>
                    <span class="info-value">{{ user.email }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Phone Number</span>
                    <span class="info-value">{{ user.phone ?? 'Not provided' }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Address</span>
                    <span class="info-value">{{ user.address ?? 'Not provided' }}</span>
                </div>
            </div>

            <div class="card-actions">
                <button id="changePasswordBtn" class="action-button primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                    Change Password
                </button>
            </div>
        </div>

        <!-- Right Column: Edit Personal Information -->
        <div class="form-card">
            <div class="card-title-section">
                <h3>Edit Personal Information</h3>
                <p class="card-description">Update your personal details and contact information</p>
            </div>

            {{ form_start(profileForm) }}
                <div class="form-fields">
                    <div class="form-row">
                        {{ form_row(profileForm.name, {
                            'row_attr': {'class': 'form-field'},
                            'attr': {
                                'placeholder': 'Enter your full name',
                                'class': 'form-input'
                            }
                        }) }}
                    </div>
                    
                    <div class="form-row">
                        {{ form_row(profileForm.email, {
                            'row_attr': {'class': 'form-field'},
                            'attr': {
                                'placeholder': 'Enter your email address',
                                'class': 'form-input'
                            }
                        }) }}
                    </div>
                    
                    <div class="form-row">
                        {{ form_row(profileForm.phone, {
                            'row_attr': {'class': 'form-field'},
                            'attr': {
                                'placeholder': 'Enter your phone number',
                                'class': 'form-input'
                            }
                        }) }}
                    </div>
                    
                    <div class="form-row">
                        {{ form_row(profileForm.address, {
                            'row_attr': {'class': 'form-field'},
                            'attr': {
                                'placeholder': 'Enter your address',
                                'class': 'form-input form-textarea',
                                'rows': 3
                            }
                        }) }}
                    </div>
                </div>

                {% if profileForm.new_password is defined %}
                    {{ form_row(profileForm.new_password, {'row_attr': {'style': 'display:none;'}}) }}
                {% endif %}

                <div class="form-footer">
                    <a href="{{ path('app_home_index') }}" class="form-button secondary">Cancel</a>
                    <button type="submit" class="form-button primary">Save Changes</button>
                </div>
            {{ form_end(profileForm) }}
        </div>
    </div>
</div>

<!-- PASSWORD MODAL -->
<div id="changePasswordModal" class="password-modal">
    <div class="modal-container">
        <div class="modal-header-section">
            <h3>Change Password</h3>
            <button class="modal-close-btn" type="button">&times;</button>
        </div>
        <div class="modal-body-section">
            {{ form_start(passwordForm) }}
                <div class="form-field">
                    {{ form_label(passwordForm.new_password) }}
                    {{ form_widget(passwordForm.new_password, {
                        'attr': {
                            'class': 'form-input',
                            'placeholder': 'Enter new password'
                        }
                    }) }}
                    {{ form_errors(passwordForm.new_password) }}
                </div>
                <div class="modal-footer">
                    <button type="button" class="form-button secondary" onclick="document.getElementById('changePasswordModal').style.display='none'">Cancel</button>
                    <button type="submit" class="form-button primary">Update Password</button>
                </div>
            {{ form_end(passwordForm) }}
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const modal = document.getElementById("changePasswordModal");
    const btn = document.getElementById("changePasswordBtn");
    const closeBtn = document.querySelector(".modal-close-btn");

    if (btn) {
        btn.addEventListener("click", () => modal.style.display = "flex");
    }
    
    if (closeBtn) {
        closeBtn.addEventListener("click", () => modal.style.display = "none");
    }
    
    window.addEventListener("click", (e) => { 
        if (e.target === modal) modal.style.display = "none"; 
    });
});
</script>
{% endblock %}
