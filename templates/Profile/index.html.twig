{% extends 'ADMIN/base.html.twig' %}

{% block title %}My Profile{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('style/css/DASHBOARD/profile.css') }}">
{% endblock %}

{% block body %}
<div class="hero-section">
    <h1>My Profile</h1>
    <p>Manage your personal information and account settings</p>
</div>

{# Flash Messages #}
{% for label, messages in app.flashes %}
    {% for message in messages %}
        <div class="flash {{ label }}">{{ message }}</div>
    {% endfor %}
{% endfor %}

<div class="profile-container">

    <!-- LEFT CARD: Avatar/Profile -->
    <div class="profile-card">
        <div class="avatar-wrapper">
            <img src="{{ user.avatar ? asset('uploads/avatars/' ~ user.avatar) : asset('images/default-avatar.png') }}"
                  class="avatar">

            <form id="avatarForm" method="post" enctype="multipart/form-data" action="{{ path('app_profile') }}">
                <input type="file" id="avatarInput" name="avatar" class="avatar-input" accept="image/*"
                       onchange="document.getElementById('avatarForm').submit()">
                <button type="button" class="change-photo-btn" onclick="document.getElementById('avatarInput').click()">
                    {{ user.avatar ? 'Change Photo' : 'Add Photo' }}
                </button>
            </form>
        </div>

        <h2 class="user-name">{{ user.name }}</h2>
        <p class="user-role">{{ user.roles|join(', ') }}</p>

        <div class="info-list">
            <div><strong>Email</strong><br>{{ user.email }}</div>
        </div>

        <button id="changePasswordBtn">Change Password</button>
    </div>

    <!-- RIGHT CARD: Personal Info -->
    <div class="detail-card">
        <h3>Personal Information</h3>
        {{ form_start(profileForm) }}
            {{ form_row(profileForm.name, {
                'row_attr': {'class': 'form-group'},
                'attr': {'placeholder': 'Enter full name'}
            }) }}
            {{ form_row(profileForm.email, {
                'row_attr': {'class': 'form-group'},
                'attr': {'placeholder': 'Enter email'}
            }) }}
            {{ form_row(profileForm.phone, {
                'row_attr': {'class': 'form-group'},
                'attr': {'placeholder': 'Enter phone number'}
            }) }}
            {{ form_row(profileForm.address, {
                'row_attr': {'class': 'form-group'},
                'attr': {'placeholder': 'Enter address'}
            }) }}

   {# Hide the password field but keep it in the form #}
        {% if profileForm.new_password is defined %}
            {{ form_row(profileForm.new_password, {'row_attr': {'style': 'display:none;'}}) }}
        {% endif %}
            <button type="submit" class="save-btn">Save Changes</button>
        {{ form_end(profileForm) }}
    </div>
</div>

<!-- PASSWORD MODAL -->
<div id="changePasswordModal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h3>Change Password</h3>
        {{ form_start(passwordForm) }}
            {{ form_row(passwordForm.new_password, {'attr': {'class': 'form-group'}}) }}
            <button type="submit" class="save-btn">Update Password</button>
        {{ form_end(passwordForm) }}
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const modal = document.getElementById("changePasswordModal");
    const btn = document.getElementById("changePasswordBtn");
    const closeBtn = document.querySelector(".close-btn");

    btn.addEventListener("click", () => modal.style.display = "flex");
    closeBtn.addEventListener("click", () => modal.style.display = "none");
    window.addEventListener("click", (e) => { if (e.target === modal) modal.style.display = "none"; });
});
</script>
{% endblock %}